import * as THREE from 'three';
// import { UltraHDRLoader } from 'three/addons/loaders/UltraHDRLoader.js';
import { RGBELoader } from 'three/addons/loaders/RGBELoader.js';
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
import { GUI } from 'three/addons/libs/lil-gui.module.min.js';
// import { RGBELoader } from 'three/addons/loaders/RGBELoader.js';

const grid_size = 100;
const camera_distance = 2;
let camera_rotation = 0;
const camera_height = 0.3;
const rule = 4; // Ruud rule
const cut_out = 0;
const iterations = 1
const start_cells = 1; // Monument
const random_threshold = 0.3;
const MAX_ITERATIONS = 10;
let rotate_voxels = false;

let animationInterval = 1000; // 1 second (in milliseconds)

// Add a flag to control the animation state
let animateVoxels = false;

// Add an interval variable to store the interval ID
let animationIntervalId;


let grid_current = [];
let grid_previous = [];
let survive_list = [];
let birth_list = [];
let max_state = 1;
let neighborhood_mode = "M";

const rule_str_list = [
    "/1-8/2/M", // Custom
    "/1-2,6-10/5/M", // Lionel 1
    "/1-3/2/M", // Hollow
    "13-26/13-14,17-19/2/M", // Clouds 1
    "/1-8/2/M", // Ruud
    "/1-2,5,6,7,8,13,14,15/3/M", // Maze
    "/1-2,5,6,7,8,13,14,15/4/M", // Labyrinth
    "/1-2,5,6,7,8,13,14,15/5/M" // Walled Cities
];

const params = {
    animationInterval: animationInterval, // New parameter for animation interval
    animateVoxels: animateVoxels, // New parameter to toggle animation
    max_iterations: MAX_ITERATIONS, // Add a new parameter for max_iterations
    autoRotate: true,
    changeColor: true,
    metalness: 1.0,
    roughness: 0.0,
    exposure: 1.0,
    rotate_voxels: rotate_voxels,
    type: 'HalfFloatType',
    rule: rule // Add the current rule to params
};

// Create rule options for dropdown
const ruleOptions = {
    "Custom": 0,
    "Lionel 1": 1,
    "Hollow": 2,
    "Clouds 1": 3,
    "Ruud": 4,
    "Maze": 5,
    "Labyrinth": 6,
    "Walled Cities": 7
};

let rule_str = rule_str_list[rule];

// Three.js setup
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setPixelRatio(window.devicePixelRatio);
renderer.setClearColor(0); // Set background color to white
renderer.shadowMap.enabled = true;
renderer.shadowMap.type = THREE.PCFSoftShadowMap;

renderer.toneMapping = THREE.ACESFilmicToneMapping;
renderer.toneMappingExposure = params.exposure;

// const environment = new RoomEnvironment();
// const pmremGenerator = new THREE.PMREMGenerator( renderer );

// scene.backgroundBlurriness = 0.5;
// const env = pmremGenerator.fromScene( environment ).texture;
// scene.background = env;
// scene.environment = env;
// environment.dispose();

const controls = new OrbitControls(camera, renderer.domElement);

renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// loader = new UltraHDRLoader();
// loader.setDataType( THREE.FloatType );
// loader.setPath('textures/');


const ambient = new THREE.AmbientLight( 0xffffff, 3 );
scene.add( ambient );

const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
directionalLight.position.set(1, 1, 1);
scene.add(directionalLight);

let color = new THREE.Color(0xff0000); // Start with red

// Create instanced mesh for voxels 
const boxGeometry = new THREE.BoxGeometry(1, 1, 1);

let instancedMesh;
const gui = new GUI();

gui.add( params, 'autoRotate' );
gui.add( params, 'changeColor' );
gui.add( params, 'metalness', 0, 1, 0.01 );
gui.add( params, 'roughness', 0, 1, 0.01 );
gui.add( params, 'exposure', 0, 4, 0.01 );

// Add rule selection to GUI as a dropdown
gui.add(params, 'rule', ruleOptions)
   .name('Rule')
   .onChange(val => {
       console.log("Rule changed to:", val);
       // Update the rule_str
       rule_str = rule_str_list[val];
       // Parse the new rule
       parseRule();
       // Reset animation state
       stopAnimation();
       params.animateVoxels = false;
       // Reinitialize the grid with the new rule
       initGrid();
       // Update the voxel mesh
       scene.remove(instancedMesh);
       createVoxelMesh();
   });

gui.add(params, 'animationInterval', 100, 5000, 100).onChange(val => {
    stopAnimation(); // Stop the current animation
    animationInterval = val; // Update the animation interval
    if (params.animateVoxels) {
        startAnimation(); // Restart the animation with the new interval
    }
});

// Add a GUI control to toggle the animation
gui.add(params, 'animateVoxels').onChange(val => {
    if (val) {
        startAnimation();
    } else {
        stopAnimation();
    }
});

gui.add(params, 'rotate_voxels').name('Rotate Voxels').onChange(val => {
    rotate_voxels = val;
    scene.remove(instancedMesh);
    createVoxelMesh();
});

gui.add(params, 'max_iterations', 1, 10, 1).onChange(val => {});

gui.open();

init();
animate();

// Add event listener for keydown event
window.addEventListener('keydown', handleKeyDown);

function handleKeyDown(event) {
  // Check if the pressed key is the space key
  if (event.code === 'Space') {
    iterateGrid();
  }
}

function iterateGrid() {
  let grid_tmp = grid_current;
  grid_current = grid_previous;
  grid_previous = grid_tmp;
  evolveGrid();

  // Update the instanced mesh
  updateVoxelMesh();

    
  color.offsetHSL(0.01, 0, 0);

  // Update the material color for all cube meshes
  if (params.changeColor) {
    scene.traverse((child) => {
      if (child instanceof THREE.Mesh) {
        child.material.color.set(color);
      }
    });
  }


  params.max_iterations--;

  // Stop the animation if max_iterations reaches 0
  if (params.max_iterations === 0) {
    stopAnimation();
  }
}

function updateVoxelMesh() {
  // Remove the existing instanced mesh
  scene.remove(instancedMesh);

  // Create a new instanced mesh
  createVoxelMesh();
}

function init() {
    initGrid();
    setupCamera();
    createVoxelMesh();
    const rgbeLoader = new RGBELoader();
    rgbeLoader.load( `textures/royal_esplanade_1k.hdr`, function ( texture ) {

        texture.mapping = THREE.EquirectangularReflectionMapping;
        texture.needsUpdate = true;

        scene.background = texture;
        scene.environment = texture;
        
        if (animateVoxels) {
            startAnimation();
        }

    } );
}

function startAnimation() {
    animationIntervalId = setInterval(iterateGrid, animationInterval);
}

function stopAnimation() {
    clearInterval(animationIntervalId);
}


function initGrid() {
    const model_monument = {
        size: [72, 72, 126],
        voxels:[0,10370,4,60,4,74,1,70,2,70,2,70,2,70,1,4320,1,70,2,70,2,70,2,70,1,74,4,60,4,4,4,60,4,74,1,70,2,70,2,70,2,70,1,4320,1,70,2,70,2,70,2,70,1,74,4,60,4,4,4,60,4,74,1,70,2,70,2,70,2,70,1,4320,1,70,2,70,2,70,2,70,1,74,4,60,4,4,4,60,4,74,1,70,2,70,2,70,2,70,1,4320,1,70,2,70,2,70,2,70,1,74,4,60,4,10372,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,70,1,359,1,71,65,7,65,7,65,8,64,8,64,8,64,8,64,7,65,7,1,8,56,7,1,8,56,7,1,8,56,16,56,16,56,16,56,8,1,7,56,7,2,7,56,7,2,7,56,7,2,7,56,7,1,8,56,16,56,16,56,16,56,8,1,7,56,7,2,7,56,7,2,7,56,7,2,7,56,7,1,8,56,16,56,16,56,16,56,8,1,7,56,7,2,7,56,7,2,7,56,7,2,7,56,7,1,8,56,16,56,16,56,16,56,8,1,7,56,7,2,7,56,7,2,7,56,7,2,7,56,7,1,8,56,16,56,16,56,16,56,8,1,7,56,8,1,7,56,8,1,7,65,7,64,8,64,8,64,8,64,8,65,7,65,7,65,71,1,137,4,68,4,68,4,68,4,2,1,70,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,6,2,6,2,6,2,6,2,6,2,6,2,6,2,6,2,6,1,503,1,1,63,7,1,1,63,9,63,9,63,9,63,9,63,9,63,9,63,7,1,8,56,7,1,8,56,16,56,16,56,16,56,16,56,16,56,8,1,7,56,7,2,7,56,7,1,8,56,16,56,16,56,16,56,16,56,16,56,8,1,7,56,7,2,7,56,7,1,8,56,16,56,16,56,16,56,16,56,16,56,8,1,7,56,7,2,7,56,7,1,8,56,16,56,16,56,16,56,16,56,16,56,8,1,7,56,7,2,7,56,7,1,8,56,16,56,16,56,16,56,16,56,16,56,8,1,7,56,8,1,7,63,9,63,9,63,9,63,9,63,9,63,9,63,1,1,7,63,1,1,503,1,6,2,6,2,6,2,6,2,6,2,6,2,6,2,6,2,6,1,578,62,10,62,10,62,10,62,10,62,10,62,10,62,10,62,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,62,10,62,10,62,10,62,10,62,10,62,10,62,10,62,1157,61,11,61,11,61,11,61,11,61,11,61,11,61,11,61,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,61,11,61,11,61,11,61,11,61,11,61,11,61,11,61,1159,60,12,60,12,60,12,60,12,60,12,60,12,60,12,60,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,60,12,60,12,60,12,60,12,60,12,60,12,60,12,60,1161,59,13,59,13,59,13,59,13,59,13,59,13,59,13,59,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,59,13,59,13,59,13,59,13,59,13,59,13,59,13,59,1163,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,1093,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,1095,9,6,2,6,2,6,2,6,2,6,9,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,48,7,1,16,48,24,48,24,48,24,48,24,48,24,48,24,48,7,1,16,48,7,1,16,1,38,9,63,9,63,9,63,9,63,9,24,1,38,9,24,1,38,9,7,1,16,1,38,9,7,1,16,1,38,9,63,9,63,9,63,9,63,9,24,1,38,9,24,1,38,9,7,1,16,1,38,9,7,1,16,1,38,9,63,9,63,9,63,9,63,9,24,1,38,9,24,1,38,9,7,1,16,1,38,9,7,1,16,1,38,9,63,9,63,9,63,9,63,9,24,1,38,9,24,1,38,9,7,1,16,1,38,17,16,1,38,17,55,17,55,17,55,17,55,17,16,1,38,17,16,2,4,4,4,4,4,4,4,4,4,18,1168,9,6,2,6,2,6,2,6,2,6,4,2,3,16,8,47,1,16,8,47,1,16,8,64,8,64,8,47,1,16,8,47,1,16,8,47,1,16,48,7,1,16,48,24,48,24,48,24,48,24,48,24,48,24,48,7,1,16,48,7,1,55,9,63,9,63,9,63,9,63,9,63,9,24,1,38,9,7,1,16,1,38,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,24,1,38,9,7,1,16,1,38,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,24,1,38,9,7,1,16,1,38,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,24,1,38,9,7,1,16,1,38,17,55,17,55,17,55,17,55,17,55,17,55,17,16,1,6,2,6,2,6,2,6,2,6,17,1168,9,6,2,6,2,6,2,6,2,6,4,2,3,16,8,47,1,16,8,47,1,16,8,64,8,64,8,47,1,16,8,47,1,16,8,47,1,16,48,7,1,16,48,24,48,24,48,24,48,24,48,24,48,24,48,7,1,16,48,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,1168,9,6,2,6,2,6,2,6,2,6,4,2,3,16,8,47,1,16,8,47,1,16,8,64,8,64,8,47,1,16,8,47,1,16,8,47,1,16,48,7,1,16,48,24,48,24,48,24,48,24,48,24,48,24,48,7,1,16,48,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,1168,9,6,2,6,2,6,2,6,2,6,4,2,3,16,8,47,1,16,8,47,1,16,8,64,8,64,8,47,1,16,8,47,1,16,8,47,1,16,48,7,1,16,48,24,48,24,48,24,48,24,48,24,48,24,48,7,1,16,48,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,1168,9,6,2,6,2,6,2,6,2,6,4,2,3,16,8,47,1,16,8,47,1,16,8,64,8,64,8,47,1,16,8,47,1,16,8,47,1,16,48,7,1,16,48,24,48,24,48,24,48,24,48,24,48,24,48,7,1,16,48,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,1168,9,6,2,6,2,6,2,6,2,6,4,2,3,16,8,47,1,16,8,47,1,16,8,64,8,64,8,47,1,16,8,47,1,16,8,47,1,16,48,7,1,16,48,24,48,24,48,24,48,24,48,24,48,24,48,7,1,16,48,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,1168,9,6,2,6,2,6,2,6,2,6,9,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,48,7,1,16,48,24,48,24,48,24,48,24,48,24,48,24,48,7,1,16,48,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,1168,9,6,2,6,2,6,2,6,2,6,9,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,48,7,1,16,48,24,48,24,48,24,48,24,48,24,48,24,48,7,1,16,48,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,1168,9,6,2,6,2,6,2,6,2,6,9,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,48,7,1,16,48,24,48,24,48,24,48,24,48,24,48,24,48,7,1,16,48,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,17,55,17,55,17,55,17,55,4,2,11,55,4,2,11,55,4,2,11,55,4,2,11,1168,9,6,2,6,2,6,2,6,2,6,9,16,8,47,1,15,9,47,1,15,9,47,1,15,9,47,1,15,9,47,1,16,8,47,1,16,8,47,1,16,48,7,1,16,48,24,48,24,48,24,48,24,48,24,48,24,48,7,1,16,48,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,17,55,17,55,17,55,17,55,4,2,11,55,4,2,11,55,4,2,11,55,4,2,11,1168,9,6,2,6,2,6,2,6,2,6,9,16,8,47,1,15,9,47,1,16,8,47,1,16,8,47,1,15,9,47,1,16,8,47,1,16,8,47,1,16,48,7,1,16,48,24,48,24,48,24,48,24,48,24,48,24,48,7,1,16,48,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,17,55,17,55,17,55,17,55,4,2,11,55,4,2,11,55,4,2,11,55,4,2,11,1168,9,6,2,6,2,6,2,6,2,6,9,16,8,47,1,15,9,47,1,16,8,47,1,16,8,47,1,15,9,47,1,16,8,47,1,16,8,47,1,16,48,7,1,16,48,24,48,24,48,24,48,24,48,24,48,24,48,7,1,16,48,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,17,55,17,55,17,55,17,55,4,2,11,55,4,2,11,55,4,2,11,55,4,2,11,1168,9,6,2,6,2,6,2,6,2,6,9,16,8,47,1,15,9,47,1,15,9,47,1,15,9,47,1,15,9,47,1,16,8,47,1,16,8,47,1,16,48,7,1,16,48,24,48,24,48,24,48,24,48,24,48,24,48,7,1,16,48,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,17,55,17,55,17,55,17,55,4,2,11,55,4,2,11,55,4,2,11,55,4,2,11,1168,9,6,2,6,2,6,2,6,2,6,9,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,48,7,1,16,48,24,48,24,48,24,48,24,48,24,48,24,48,7,1,16,48,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,17,55,17,55,17,55,17,55,4,2,11,55,4,2,11,55,4,2,11,55,4,2,11,1168,9,6,2,6,2,6,2,6,2,6,9,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,48,7,1,16,48,24,48,24,48,24,48,24,48,24,48,24,48,7,1,16,48,7,1,16,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,7,1,16,8,31,9,7,1,16,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,7,1,16,8,31,9,7,1,16,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,7,1,16,16,23,9,7,1,16,16,23,9,24,16,23,9,24,16,23,9,24,16,23,9,24,16,23,9,24,16,23,9,24,16,23,9,7,1,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,1168,9,6,2,6,2,6,2,6,2,6,9,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,48,7,1,16,48,24,48,24,48,24,48,24,48,24,48,24,48,7,1,16,48,7,1,16,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,24,2,4,2,31,9,7,1,16,1,6,1,31,9,7,1,16,1,6,1,31,9,63,9,63,9,63,9,63,9,24,1,6,1,31,9,24,1,6,1,31,9,7,1,16,1,6,1,31,9,7,1,16,1,6,1,31,9,63,9,63,9,63,9,63,9,24,1,6,1,31,9,24,1,6,1,31,9,7,1,16,1,7,1,6,1,23,9,7,1,16,1,38,9,63,9,63,9,63,9,63,9,24,1,38,9,24,2,6,1,6,1,23,9,7,1,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,1168,9,6,2,6,2,6,2,6,2,6,9,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,48,7,1,16,48,24,48,24,48,24,48,24,48,24,48,24,48,7,1,16,48,7,1,16,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,7,1,16,1,6,1,31,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,24,1,6,1,31,9,7,1,16,1,6,1,31,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,24,1,6,1,31,9,7,1,16,1,7,1,6,1,23,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,24,1,7,1,6,1,23,9,7,1,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,1168,9,6,2,6,2,6,2,6,2,6,9,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,48,7,1,16,48,24,48,24,48,24,48,24,48,24,48,24,48,7,1,16,48,7,1,16,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,24,2,4,2,31,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,24,1,6,1,23,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,32,1,6,1,23,9,7,1,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,1168,9,6,2,6,2,6,2,6,2,6,9,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,48,7,1,16,48,24,48,24,48,24,48,24,48,24,48,24,48,7,1,16,48,7,1,16,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,24,1,6,1,23,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,32,1,6,1,23,9,7,1,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,1168,9,6,2,6,2,6,2,6,2,6,9,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,48,7,1,16,48,24,48,24,48,24,48,24,48,24,48,24,48,7,1,16,48,7,1,16,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,24,2,4,2,31,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,24,1,6,1,23,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,32,1,6,1,23,9,7,1,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,1168,10,4,4,4,4,4,4,4,4,4,10,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,48,7,1,16,48,7,1,16,48,24,48,24,48,24,48,24,48,7,1,16,48,7,1,16,48,7,1,16,8,31,9,7,1,16,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,24,8,31,9,7,1,16,8,31,9,7,1,55,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,24,1,6,1,23,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,7,1,24,1,6,1,23,9,7,1,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,1168,11,2,6,2,6,2,6,2,6,2,11,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,8,47,1,16,48,7,1,16,48,7,1,16,48,7,1,16,48,24,48,24,48,7,1,16,48,7,1,16,48,7,1,16,48,7,1,16,8,31,9,7,1,16,8,31,9,7,1,16,8,31,9,24,8,31,9,24,8,31,9,7,1,16,8,31,9,7,1,16,2,4,2,31,9,7,1,55,9,7,1,55,9,7,1,55,9,7,1,55,9,63,9,63,9,7,1,55,9,7,1,55,9,7,1,55,9,7,1,55,9,7,1,55,9,7,1,55,9,63,9,63,9,7,1,55,9,7,1,55,9,7,1,24,1,6,1,23,9,7,1,55,9,7,1,55,9,7,1,55,9,63,9,63,9,7,1,55,9,7,1,24,1,6,1,23,9,7,1,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,1168,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,8,31,17,16,8,31,17,16,8,31,17,16,8,31,17,16,8,31,17,16,8,31,17,16,8,31,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,24,1,6,1,23,17,55,17,55,17,55,17,55,17,55,17,55,17,24,1,6,1,23,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,1168,34,4,4,4,4,4,2,16,32,23,1,16,32,40,32,40,32,40,32,40,32,23,1,16,32,23,1,8,48,8,2,4,2,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,16,40,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,2,4,2,31,1,8,8,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,1,15,1,55,1,15,1,55,1,71,1,71,1,71,1,71,1,15,1,55,1,15,1,24,1,6,1,23,1,15,1,55,1,15,1,55,1,71,1,71,1,71,1,71,1,15,1,24,1,6,1,23,1,15,1,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,48,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,608,33,6,2,6,2,6,1,16,32,40,32,40,32,40,32,40,32,40,32,40,32,23,1,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,16,40,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,1,15,1,55,1,71,1,71,1,71,1,71,1,71,1,71,1,15,1,24,1,6,1,23,1,15,1,55,1,71,1,71,1,71,1,71,1,71,1,40,1,6,1,23,1,15,1,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,48,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,546,4,4,4,4,4,42,32,40,32,40,32,40,32,40,32,40,32,40,32,40,32,32,48,8,2,4,2,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,16,40,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,2,4,2,31,1,8,8,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,40,1,6,1,23,1,71,1,71,1,71,1,71,1,71,1,71,1,40,1,6,1,23,1,71,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,48,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,546,1,2,1,4,1,2,1,4,1,2,1,42,32,40,32,40,32,40,32,40,32,40,32,40,32,40,32,32,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,16,40,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,40,1,6,1,23,1,71,1,71,1,71,1,71,1,71,1,71,1,40,1,6,1,23,1,71,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,48,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,546,1,2,1,4,1,2,1,4,1,2,1,42,32,40,32,40,32,40,32,40,32,40,32,40,32,40,32,32,48,8,2,4,2,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,16,40,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,2,4,2,31,1,8,8,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,40,1,6,1,23,1,71,1,71,1,71,1,71,1,71,1,71,1,40,1,6,1,23,1,71,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,48,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,546,4,4,4,4,4,42,32,40,32,40,32,40,32,40,32,40,32,40,32,40,32,32,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,16,40,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,40,2,4,2,23,1,47,1,23,1,71,1,71,1,71,1,71,1,47,1,23,1,40,1,6,1,23,1,71,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,48,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,608,32,40,32,40,32,40,32,40,32,40,32,40,32,40,32,32,48,8,2,4,2,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,16,40,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,2,4,2,31,1,8,8,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,40,3,2,3,23,1,47,1,23,1,47,1,23,1,71,1,71,1,47,1,23,1,47,1,23,1,40,1,6,1,23,1,71,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,48,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,608,32,40,32,40,32,40,32,40,32,40,32,40,32,40,32,32,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,8,48,8,8,16,40,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,16,8,31,1,8,8,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,1,71,1,71,1,71,1,71,1,71,1,71,1,39,10,22,1,39,10,22,1,39,10,22,1,39,10,22,1,39,10,22,1,39,10,22,1,39,10,22,1,39,10,22,1,39,10,22,1,39,10,22,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,40,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,32,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,32,40,32,40,32,40,32,40,32,40,32,40,32,40,32,32,2,4,42,8,2,4,2,8,1,7,40,8,1,6,1,16,40,32,40,32,40,32,40,24,1,7,40,15,1,8,2,4,42,8,1,6,1,16,40,8,1,6,1,16,24,15,1,8,1,6,1,16,24,15,1,8,1,23,24,15,1,32,24,15,1,32,24,15,1,32,24,15,1,8,1,6,1,16,2,4,18,15,1,8,1,6,1,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,41,6,24,1,41,6,24,1,41,6,24,1,41,6,24,1,41,6,24,1,41,6,24,1,71,1,71,17,55,17,55,17,55,17,55,17,55,17,55,17,48,24,40,2,4,2,7,1,71,1,344,1,14,1,56,2,4,4,4,2,32,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,32,40,32,40,32,40,32,40,32,40,32,40,32,40,32,32,1,6,41,8,1,6,1,16,40,32,40,32,40,32,40,32,40,32,40,24,1,6,41,15,1,16,40,8,1,6,1,16,24,15,1,8,1,23,24,15,1,32,24,15,1,32,24,15,1,32,24,15,1,32,24,15,1,32,24,15,1,8,1,6,1,55,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,71,17,55,17,55,17,55,17,55,17,55,17,48,24,55,17,40,1,6,1,7,1,495,2,6,1,32,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,32,40,32,41,31,41,31,41,31,41,31,40,32,40,32,32,1,7,40,32,40,32,40,32,40,32,40,32,40,32,40,24,1,7,40,32,40,32,24,15,1,32,24,15,1,32,24,15,1,32,24,15,1,32,24,15,1,32,24,15,1,32,2,4,18,15,1,71,15,57,15,57,15,57,15,57,15,57,15,57,15,57,15,57,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,71,17,55,17,55,17,55,17,55,17,48,24,55,17,55,11,4,2,592,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,32,40,32,41,31,41,31,41,31,41,31,40,32,40,32,32,1,7,40,32,40,32,40,32,40,32,40,32,40,32,40,24,1,7,40,32,40,32,24,15,1,32,24,15,1,32,24,15,1,32,24,15,1,32,24,15,1,32,24,15,1,32,24,15,1,71,14,58,14,58,14,58,14,58,14,58,14,58,14,58,14,58,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,71,17,55,17,55,17,55,17,48,24,55,17,55,17,55,11,4,2,592,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,32,40,32,41,31,41,31,41,31,41,31,40,32,40,32,32,1,7,40,32,40,32,40,32,40,32,40,32,40,32,40,24,1,7,40,32,40,32,24,15,1,32,24,15,1,32,24,15,1,32,24,15,1,32,24,15,1,32,24,15,1,32,2,4,18,15,1,71,13,59,13,59,13,59,13,59,13,59,13,59,13,59,13,59,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,71,17,55,17,55,17,48,24,55,17,55,17,55,17,55,11,4,2,592,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,32,40,32,41,31,41,31,41,31,41,31,40,32,40,32,32,1,7,40,32,40,32,40,32,40,32,40,32,40,32,40,24,1,7,40,32,40,32,24,15,1,32,24,15,1,32,24,15,1,32,24,15,1,32,24,15,1,32,24,15,1,32,24,15,1,71,12,60,12,60,12,60,12,60,12,60,12,60,12,60,12,60,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,71,17,55,17,48,24,55,17,55,17,55,17,55,17,55,11,4,2,592,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,32,40,32,40,32,40,32,40,32,40,32,40,32,40,32,32,1,7,40,32,40,32,40,32,40,32,40,32,40,32,40,24,1,7,40,32,40,32,24,15,1,32,24,15,1,32,24,15,1,32,24,15,1,32,24,15,1,32,24,15,1,32,2,4,18,15,1,71,11,61,11,61,11,61,11,61,11,61,11,61,11,61,11,61,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,71,17,48,24,55,17,55,17,55,17,55,17,55,17,55,17,592,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,32,40,32,40,32,40,32,40,32,40,32,40,32,40,32,32,1,7,40,32,40,32,40,32,40,32,40,32,40,32,40,24,1,7,40,32,40,32,24,15,1,32,24,15,1,32,24,15,1,32,24,15,1,32,24,15,1,32,24,15,1,32,24,15,1,71,10,62,10,62,10,62,10,62,10,62,10,62,10,62,10,62,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,40,8,23,1,64,24,55,17,55,17,55,17,55,17,55,17,55,17,55,17,592,2,4,2,64,1,6,1,352,1,6,1,64,1,6,1,64,31,41,31,41,31,41,31,41,31,41,31,41,31,41,31,33,1,7,40,32,40,32,40,32,40,32,40,32,40,32,40,24,1,7,40,32,40,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,71,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,10,62,11,32,4,25,12,31,4,25,13,30,4,25,14,29,4,25,15,57,16,49,24,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,592,1,6,1,496,1,6,1,64,19,2,9,42,19,2,9,42,19,2,9,42,19,2,9,42,30,42,30,42,30,42,30,34,1,7,40,32,40,32,40,32,40,32,40,32,40,32,40,24,1,7,40,32,40,48,8,15,1,48,8,15,1,48,8,15,1,48,3,2,3,15,1,48,3,2,3,15,1,48,3,2,3,15,1,48,3,2,3,15,1,71,4,2,3,63,4,2,3,63,4,2,3,63,4,2,3,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,10,62,11,32,4,25,12,31,4,25,13,30,4,25,14,29,4,25,15,50,23,56,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,1168,19,2,8,43,19,2,8,43,19,2,8,43,19,2,8,43,29,43,29,43,29,43,29,35,1,7,40,32,40,32,40,32,40,32,40,32,40,32,40,24,1,7,40,32,40,48,8,15,1,48,8,15,1,48,8,15,1,48,3,2,3,15,1,48,3,2,3,15,1,48,3,2,3,15,1,48,3,2,3,15,1,71,4,2,3,63,4,2,3,63,4,2,3,63,4,2,3,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,10,62,11,61,12,60,13,59,14,51,22,57,16,56,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,1168,19,2,7,44,19,2,7,44,19,2,7,44,19,2,7,44,28,44,28,44,28,44,28,36,1,7,40,32,40,32,40,32,40,32,40,32,40,32,40,24,1,7,40,32,40,48,8,15,1,48,8,15,1,48,8,15,1,48,3,2,3,15,1,48,3,2,3,15,1,48,3,2,3,15,1,48,3,2,3,15,1,71,4,2,3,63,4,2,3,63,4,2,3,63,4,2,3,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,10,62,11,61,12,60,13,52,21,58,15,57,16,56,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,1168,19,2,6,45,19,2,6,45,19,2,6,45,19,2,6,45,27,45,27,45,27,45,27,37,1,7,40,32,40,32,40,32,40,32,40,32,40,32,40,24,1,7,40,32,40,48,8,15,1,48,8,15,1,48,8,15,1,48,3,2,3,15,1,48,3,2,3,15,1,48,3,2,3,15,1,48,3,2,3,15,1,71,4,2,3,63,4,2,3,63,4,2,3,63,4,2,3,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,10,62,11,61,12,53,20,59,14,58,15,57,16,56,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,1168,19,2,5,46,19,2,5,46,19,2,5,46,19,2,5,46,26,46,26,46,26,46,26,38,1,7,40,32,40,32,40,32,40,32,40,32,40,32,40,24,1,7,40,32,40,48,8,15,1,48,8,15,1,48,8,15,1,48,3,2,3,15,1,48,3,2,3,15,1,48,3,2,3,15,1,48,3,2,3,15,1,71,4,2,3,63,4,2,3,63,4,2,3,63,4,2,3,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,10,62,11,54,19,60,13,59,14,58,15,57,16,56,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,1168,19,2,4,47,19,2,4,47,19,2,4,47,19,2,4,47,25,47,25,47,25,47,25,39,1,7,40,32,40,32,40,32,40,32,40,32,40,32,40,24,1,7,40,32,40,48,8,15,1,48,8,15,1,48,8,15,1,48,3,2,3,15,1,48,3,2,3,15,1,48,3,2,3,15,1,48,3,2,3,15,1,71,4,2,3,63,4,2,3,63,4,2,3,63,4,2,3,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,10,55,18,61,12,60,13,59,14,58,15,57,16,56,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,1168,24,48,24,48,24,48,24,48,24,48,24,48,24,48,24,40,1,7,40,32,40,32,40,32,40,32,40,32,40,32,40,24,1,7,40,32,40,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,71,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,56,17,62,11,61,12,60,13,59,14,58,15,57,16,56,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,1168,23,49,23,49,23,49,23,49,23,49,23,49,23,49,23,41,1,7,40,32,40,32,40,32,40,32,40,32,40,32,40,24,1,7,40,32,40,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,64,8,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,25,47,25,47,25,47,25,47,25,47,25,47,25,47,25,1160,22,50,22,50,22,50,22,50,22,50,22,50,22,50,22,42,1,7,40,32,40,32,40,32,40,32,40,32,40,32,40,24,1,7,40,32,40,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,64,8,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,25,47,25,47,25,47,25,47,25,47,25,47,25,47,25,1160,21,51,21,51,21,51,21,51,21,51,21,51,21,51,21,43,1,7,40,32,40,32,40,32,40,32,40,32,40,32,40,24,1,7,40,32,40,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,64,8,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,25,47,25,47,25,47,25,47,25,47,25,47,25,47,25,1160,20,52,20,52,20,52,20,52,20,52,20,52,20,52,20,44,1,7,40,32,40,32,40,32,40,32,40,32,40,32,40,24,1,7,40,32,40,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,64,8,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,25,47,25,47,25,47,25,47,25,47,25,47,25,47,25,1160,19,53,19,53,19,53,19,53,19,53,19,53,19,53,19,45,1,7,40,32,40,32,40,32,40,32,40,32,40,32,40,24,1,7,40,32,40,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,64,8,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,25,47,25,47,25,47,25,47,25,47,25,47,25,47,25,1160,18,54,18,54,18,54,18,54,18,54,18,54,18,54,18,46,1,7,40,32,40,32,40,32,40,32,40,32,40,32,40,24,1,7,40,32,40,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,64,8,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,25,47,25,47,25,47,25,47,25,47,25,47,25,47,25,1160,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,47,1,7,40,32,40,32,40,32,40,32,40,32,40,32,40,24,1,7,40,32,40,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,64,8,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,25,47,25,47,25,47,25,47,25,47,25,47,25,47,25,1160,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,56,1,7,40,32,40,32,40,32,40,32,40,32,40,32,40,24,1,7,40,32,40,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,48,8,15,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,64,8,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,25,47,25,47,25,47,25,47,25,47,25,47,25,47,25,616,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,48,24,48,24,48,24,48,24,48,24,48,24,48,24,48,24,48,24,32,15,1,24,32,15,1,24,32,15,1,24,32,15,1,24,32,15,1,24,32,15,1,24,32,15,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,64,8,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,19,4,2,47,17,7,1,47,17,55,17,55,17,55,17,55,17,7,1,47,19,4,2,616,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,48,24,48,24,48,24,48,24,48,24,48,24,48,24,48,24,48,24,32,15,1,24,32,15,1,24,32,15,1,24,32,15,1,24,32,15,1,24,32,15,1,24,32,15,1,71,1,71,1,71,1,71,1,71,1,71,1,64,8,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,18,6,1,47,17,55,17,55,17,55,17,55,17,55,17,55,18,6,1,616,8,64,8,64,9,63,9,63,9,63,9,63,8,64,8,24,10,4,2,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,48,24,48,24,48,24,48,24,48,24,48,24,48,24,48,24,48,24,32,15,1,24,32,15,1,24,32,15,1,24,32,15,1,24,32,15,1,24,32,15,1,24,32,15,1,71,1,71,1,71,1,71,1,71,1,64,8,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,624,8,64,8,64,9,63,9,63,9,63,9,63,8,64,8,24,10,4,2,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,48,24,48,24,48,24,48,24,48,24,48,24,48,24,48,24,48,24,32,15,1,24,32,15,1,24,32,15,1,24,32,15,1,24,32,15,1,24,32,15,1,24,32,15,1,71,1,71,1,71,1,71,1,64,8,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,624,8,64,8,64,9,63,9,63,9,63,9,63,8,64,8,24,10,4,2,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,48,24,48,24,48,24,48,24,48,24,48,24,48,24,48,24,48,24,32,15,1,24,32,15,1,24,32,15,1,24,32,15,1,24,32,15,1,24,32,15,1,24,32,15,1,71,1,71,1,71,1,64,8,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,624,8,64,8,64,9,63,9,63,9,63,9,63,8,64,8,24,10,4,2,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,48,24,48,24,48,24,48,24,48,24,48,24,48,24,48,24,48,24,32,15,1,24,32,15,1,24,32,15,1,24,32,15,1,24,32,15,1,24,32,15,1,24,32,15,1,71,1,71,1,64,8,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,624,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,16,24,8,24,48,24,48,24,48,24,48,24,48,24,48,24,48,24,48,24,48,24,32,15,1,24,32,15,1,24,32,15,1,24,32,15,1,24,32,15,1,24,32,15,1,24,32,15,1,71,1,64,8,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,1,71,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,624,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,24,16,23,9,24,16,23,9,24,16,23,9,24,16,23,9,24,16,23,9,24,16,23,9,24,16,23,9,24,16,23,9,24,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,32,1,6,1,24,8,32,8,24,8,32,8,24,8,32,8,24,8,32,8,24,8,32,8,24,8,32,8,24,8,32,8,24,48,24,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,55,17,624,2,4,2,64,1,6,1,352,1,6,1,64,1,6,1,24,2,4,4,4,27,6,1,24,1,15,25,6,1,40,23,49,23,49,23,49,23,33,1,15,25,6,1,24,1,15,25,6,1,24,1,7,50,4,2,8,1,7,48,7,1,16,48,24,48,24,48,24,48,16,1,7,48,7,1,8,1,7,48,7,1,8,1,62,1,8,1,62,1,296,1,30,1,31,1,8,2,4,4,4,4,4,4,4,2,31,1,56,8,7,1,56,8,7,1,56,8,64,8,64,8,64,8,64,8,7,1,56,8,7,1,56,8,7,1,56,8,7,1,56,7,65,7,65,7,65,7,65,8,7,1,56,8,7,1,55,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,7,1,55,11,4,2,624,1,6,1,496,1,6,1,24,1,6,2,6,26,6,1,40,24,48,24,48,24,48,24,48,24,48,24,32,1,15,25,6,1,24,1,7,49,6,1,16,48,24,48,24,48,24,48,24,48,24,48,16,1,7,48,7,1,8,1,62,1,440,1,6,2,6,2,6,2,6,1,31,1,56,8,7,1,56,8,64,8,64,8,64,8,64,8,64,8,64,8,7,1,56,8,7,1,56,8,64,8,64,8,64,8,64,8,64,8,64,8,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,9,7,1,55,9,7,1,55,9,63,9,63,9,63,9,63,9,63,9,63,10,6,1,1176,24,48,24,48,23,49,23,49,23,49,23,49,24,48,24,40,48,24,48,24,48,24,48,24,48,24,48,24,48,24,48,640,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,7,65,7,65,7,65,7,65,8,64,8,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,1184,24,48,24,48,24,48,24,48,24,48,24,48,24,48,24,40,48,24,48,24,48,24,48,24,48,24,48,24,48,24,48,640,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,1184,24,48,24,48,23,49,23,49,23,49,23,49,24,48,24,40,48,24,48,24,48,24,48,24,48,24,48,24,48,24,48,640,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,7,65,7,65,7,65,7,65,8,64,8,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,1184,24,48,24,48,24,48,24,48,24,48,24,48,24,48,24,40,48,24,48,24,48,24,48,24,48,24,48,24,48,24,48,640,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,1184,24,48,24,48,23,49,23,49,23,49,23,49,24,48,24,40,48,24,48,24,48,24,48,24,48,24,48,24,48,24,48,640,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,7,65,7,65,7,65,7,65,8,64,8,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,1184,24,48,24,48,24,48,24,48,24,48,24,48,24,48,24,40,48,24,48,24,48,24,48,24,48,24,48,24,48,24,48,640,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,63,9,1184,2,4,4,4,4,4,2,48,1,22,1,336,1,22,1,48,1,22,1,40,10,4,34,24,48,24,48,24,48,24,48,24,48,24,48,24,48,568,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,7,65,7,65,7,65,7,65,8,64,8,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,1184,1,6,2,6,2,6,1,480,1,22,1,40,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,64,8,64,8,352,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,11,2,3,56,11,2,3,56,11,2,3,56,11,2,3,56,11,2,3,1752,10,4,5,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,7,65,7,65,7,65,7,65,8,64,8,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,11,2,3,56,11,2,3,56,11,2,3,56,11,2,3,56,11,2,3,1752,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,11,2,3,56,11,2,3,56,11,2,3,56,11,2,3,56,11,2,3,1752,10,4,5,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,7,65,7,65,7,65,7,65,8,64,8,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,11,2,3,56,11,2,3,56,11,2,3,56,11,2,3,56,11,2,3,1752,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,11,2,3,56,11,2,3,56,11,2,3,56,11,2,3,56,11,2,3,1752,10,4,5,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,24,19,2,14,2,11,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,7,65,7,65,7,65,7,65,8,64,8,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,11,2,3,56,11,2,3,56,11,2,3,56,11,2,3,56,11,2,3,1176,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,48,24,48,24,48,24,48,24,48,24,48,24,48,24,48,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,56,16,1176,2,4,2,64,1,6,1,352,1,6,1,64,1,6,1,64,1,6,3,4,4,4,4,4,4,4,4,4,2,71,1,26,4,68,4,68,4,68,4,113,1,31,3,4,4,4,4,4,4,4,2,7,1,64,1,6,1,64,1,6,1,352,1,6,1,64,1,6,1,64,1,6,1,64,1,6,1,352,1,6,1,64,1,6,1,64,1,6,1,64,1,6,1,352,1,6,1,64,1,6,1,56,2,4,2,7,1,56,1,14,1,344,1,14,1,56,1,7,2,4,2,56,1,6,9,56,1,6,9,64,8,64,8,64,8,64,8,56,1,6,9,56,1,6,9,1176,1,6,1,496,1,6,1,64,1,6,2,6,2,6,2,6,2,6,2,6,1,463,2,6,2,6,2,6,2,6,1,7,1,63,2,6,1,496,1,6,1,64,1,6,1,496,1,6,1,64,1,6,1,496,1,6,1,56,1,6,1,7,1,488,1,7,1,6,1,56,1,6,9,64,8,64,8,64,8,64,8,64,8,64,8,56,1,6,9,1752,1,6,1,503,1,2408,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,1752,1,6,1,503,1,2408,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,1752,1,6,1,503,1,2408,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,1752,1,6,1,503,1,2408,8,64,8,64,8,208,8,64,8,64,8,1752,1,6,1,503,1,2408,8,64,8,64,8,208,8,64,8,64,8,1752,1,6,1,503,1,2408,8,64,8,64,8,208,8,64,8,64,8,1752,1,6,1,503,1,2408,8,64,8,64,8,208,8,64,8,64,8,1752,1,6,1,503,1,2408,8,64,8,64,8,208,8,64,8,64,8,1752,1,6,1,503,1,2408,8,64,8,64,8,208,8,64,8,64,8,1752,1,6,1,503,1,2408,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,1752,1,6,1,503,1,2408,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,1752,2,4,2,71,1,359,1,71,1,2408,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,1752,3,2,3,71,1,71,1,215,1,71,1,71,1,2408,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,1679,10,62,10,62,10,62,10,62,10,62,10,62,10,62,10,62,10,2334,10,62,10,62,10,62,10,62,10,62,10,62,10,62,10,62,10,62,10,1752,6,66,6,66,6,66,6,66,6,66,6,2554,6,66,6,66,6,66,6,66,6,66,6,1825,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,2408,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,1752,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,2408,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,1752,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,2408,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,1752,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,2408,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,1752,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,2408,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,1752,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,2408,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,1752,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,2408,8,64,8,64,8,64,8,64,8,64,8,64,8,64,8,1898,4,68,4,68,4,68,4,2700,4,68,4,68,4,68,4,2044,4,68,4,68,4,68,4,2700,4,68,4,68,4,68,4,21474]
    }
    grid_previous = Array.from({length: grid_size * grid_size * grid_size});
    grid_current = Array.from({length: grid_size * grid_size * grid_size}, () => 0);

    if (start_cells == 0) { 
        // Full cube random
        for (let z = 0; z < grid_size; z++) {
            for (let y = 0; y < grid_size; y++) {
                for (let x = 0; x < grid_size; x++) {
                    grid_current[index(x,y,z)] = Math.random() > random_threshold ? 1 : 0;
                }
            }
        }
    } else if (start_cells == 1) { 
        // Half cube random
        for (let z = 0; z < grid_size; z++) {
            for (let y = 0; y < grid_size; y++) {
                for (let x = 0; x < grid_size; x++) {
                    if ((Math.abs(x - grid_size / 2) < grid_size / 4) && 
                        (Math.abs(y - grid_size / 2) < grid_size / 4) && 
                        (Math.abs(z - grid_size / 2) < grid_size / 4)) {
                        grid_current[index(x,y,z)] = Math.random() > random_threshold ? 1 : 0;
                    }
                }
            }
        }
    } else if (start_cells == 2) { 
        // Single cell
        const center = Math.round(grid_size / 2);
        grid_current[index(center,center,center)] = 1;
    } else if (start_cells == 4) {
        // Monument model
        loadModel(model_monument);
    }

    parseRule();

    // Run iterations
    for (let i = 0; i < iterations; i++) {
        let grid_tmp = grid_current;
        grid_current = grid_previous;
        grid_previous = grid_tmp;
        evolveGrid();
    }

    applyCutOut();
}

function createVoxelMesh() {
    // Count active voxels
    let activeVoxels = 0;
    for (let i = 0; i < grid_current.length; i++) {
        if (grid_current[i] > 0) activeVoxels++;
    }
    const material = new THREE.MeshPhongMaterial({
        color: color,
        transparent: false,
        opacity: 0.5,
        reflectivity: 0.9,
        envMap: scene.environment // Use the environment map for reflections
    });

    // Create instanced mesh
    instancedMesh = new THREE.InstancedMesh(boxGeometry, material, activeVoxels);
    instancedMesh.instanceMatrix.setUsage(THREE.DynamicDrawUsage);
    instancedMesh.castShadow = true; // Enable shadow casting

    // Set transforms for each voxel
    const matrix = new THREE.Matrix4();
    const rotationMatrix = new THREE.Matrix4();
    let instanceIndex = 0;

    for (let z = 0; z < grid_size; z++) {
        for (let y = 0; y < grid_size; y++) {
            for (let x = 0; x < grid_size; x++) {
                if (grid_current[index(x, y, z)] > 0) {
                    matrix.setPosition(
                        x - grid_size/2,
                        y - grid_size/2,
                        z - grid_size/2
                    );
                    
                    if (params.rotate_voxels) {
                        // Random rotation between -30 and 30 degrees
                        const rotation = (Math.random() * 60 - 30) * Math.PI / 180;
                        rotationMatrix.makeRotationY(rotation);
                        matrix.multiply(rotationMatrix);
                    }
                    
                    instancedMesh.setMatrixAt(instanceIndex, matrix);
                    instanceIndex++;
                }
            }
        }
    }

    scene.add(instancedMesh);
}

function setupCamera() {
    const radius = grid_size * camera_distance;
    const xx = radius * Math.cos(camera_rotation * Math.PI * 2);
    const yy = radius * camera_height;
    const zz = radius * -Math.sin(camera_rotation * Math.PI * 2);
    
    // Update the camera position
    camera.position.set(xx + 0.5, yy + 0.5, zz + 0.5);
    
    // Update the camera target to look at the center of the grid
    const targetX = grid_size / 2;
    const targetY = grid_size / 2;
    const targetZ = grid_size / 2;
    camera.lookAt(targetX, targetY, targetZ);
}

function evolveGrid() {
    for (let z = 0; z < grid_size; z++) {
        for (let y = 0; y < grid_size; y++) {
            for (let x = 0; x < grid_size; x++) {
                const count = countNeighbors(x, y, z);
                grid_current[index(x, y, z)] = applyRule(grid_previous[index(x, y, z)], count);
            }
        }
    }
}

function applyRule(state, count) {
    if (state == 1) {
      for (let i = 0; i < survive_list.length; i++) {
        if (count == survive_list[i]) return 1;
      }
    } else if (state == 0) {
      for (let i = 0; i < birth_list.length; i++) {
        if (count == birth_list[i]) return 1;
      }
    }
  
    if (state > 0 && state + 1 <= max_state) return state + 1;
    
    return 0;
}  

function countNeighbors(x, y, z) {
    let count = 0;

    if (neighborhood_mode == "M") { // Moore neighborhood
        for (let dz = -1; dz <= 1; dz++) {
            for (let dy = -1; dy <= 1; dy++) {
                for (let dx = -1; dx <= 1; dx++) {
                    if (dx == 0 && dy == 0 && dz == 0) continue;
                    const xx = (x + dx + grid_size) % grid_size;
                    const yy = (y + dy + grid_size) % grid_size;
                    const zz = (z + dz + grid_size) % grid_size;
                    if (grid_previous[index(xx, yy, zz)] > 0) count++;
                }
            }
        }
    } else if (neighborhood_mode == "N") { // von Neumann neighborhood
        if (grid_previous[index((x-1+grid_size)%grid_size, y, z)] > 0) count++;
        if (grid_previous[index((x+1+grid_size)%grid_size, y, z)] > 0) count++;
        if (grid_previous[index(x, (y-1+grid_size)%grid_size, z)] > 0) count++;
        if (grid_previous[index(x, (y+1+grid_size)%grid_size, z)] > 0) count++;
        if (grid_previous[index(x, y, (z-1+grid_size)%grid_size)] > 0) count++;
        if (grid_previous[index(x, y, (z+1+grid_size)%grid_size)] > 0) count++;
    }

    return count;
}

function index(x, y, z) {
    return x + y * grid_size + z * grid_size * grid_size;
}

function parseRule() {
    survive_list = [];
    birth_list = [];
    max_state = 1;
    neighborhood_mode = "M";

    const phases = rule_str.split("/");
    if (phases.length != 4) return;

    survive_list = getList(phases[0]);
    birth_list = getList(phases[1]);
    max_state = parseInt(phases[2]) - 1;
    neighborhood_mode = phases[3];
}

function getList(str) {
    const list = [];
    const ranges = str.split(",");
    ranges.forEach(r => getRange(r).forEach(n => list.push(n)));
    return list;
}

function getRange(str) {
    if (str.length < 1) return [];
    const sides = str.split("-");
    if (sides.length == 2) {
        const list = [];
        const min = parseInt(sides[0]);
        const max = parseInt(sides[1]);
        for (let i = min; i <= max; i++) list.push(i);
        return list;
    }
    return [parseInt(sides[0])];
}

function applyCutOut() {
    if (cut_out > 0) {
        for (let z = 0; z < grid_size; z++) {
            for (let y = 0; y < grid_size; y++) {
                for (let x = 0; x < grid_size; x++) {
                    if ((grid_size-1-x) < grid_size*cut_out && 
                        (grid_size-1-y) < grid_size*cut_out && 
                        z < grid_size*cut_out) {
                        grid_current[index(x,y,z)] = 0;
                    }
                }
            }
        }
    }
}

function loadModel(model_vox) {
    const x_size = model_vox.size[0];
    const y_size = model_vox.size[1];
    const z_size = model_vox.size[2];

    let count_index = -1;
    let count_target = 0;
    let count = 0;
    let current = 1;

    for (let z = 0; z < z_size; z++) {
        for (let y = 0; y < y_size; y++) {
            for (let x = 0; x < x_size; x++) {
                while (count >= count_target) {
                    count_index++;
                    if (count_index >= model_vox.voxels.length) {
                        x = x_size;
                        y = y_size;
                        z = z_size;
                        break;
                    }
                    count = 0;
                    count_target = model_vox.voxels[count_index];
                    current = 1 - current;
                }
                count++;

                const xx = x - Math.floor(x_size / 2) + Math.floor(grid_size / 2);
                const yy = y - Math.floor(y_size / 2) + Math.floor(grid_size / 2);
                const zz = z - Math.floor(z_size / 2) + Math.floor(grid_size / 2);

                if (xx > 0 && yy > 0 && zz > 0 && xx < grid_size && yy < grid_size && zz < grid_size) {
                    grid_current[index(yy,zz,xx)] = current;
                }
            }
        }
    }
}

function animate() {
    requestAnimationFrame(animate);

    if ( params.autoRotate ) {

        instancedMesh.rotation.y += 0.001;

    }


    controls.update();

    renderer.render(scene, camera);
}

// Handle window resizing
window.addEventListener('resize', onWindowResize, false);

function onWindowResize() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
}

